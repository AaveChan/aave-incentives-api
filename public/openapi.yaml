openapi: 3.0.3
info:
  title: Aave Incentives API
  description: |
    API to fetch all incentives available on the Aave V3 protocol across multiple chains.

    This API aggregates incentives from multiple sources:
    - ACI MASIv Infra incentives
    - Merkl infra incentives
    - Onchain incentives
    - Local config incentives

  version: 1.0.0
  contact:
    name: ACI
    url: https://www.aavechan.com/
  license:
    name: MIT

servers:
  - url: https://aave-incentives-api.vercel.app/
    description: Production server
  - url: http://localhost:5050
    description: Local development

tags:
  - name: Incentives
    description: Endpoints for fetching and filtering incentives
  - name: Health
    description: API health and monitoring

paths:
  /api/incentives:
    get:
      tags:
        - Incentives
      summary: Get all incentives
      description: |
        Fetches all available incentives with optional filtering, sorting, and pagination.

        Results are cached for 5 minutes for optimal performance.
      operationId: getIncentives
      parameters:
        - $ref: '#/components/parameters/ChainIdParam'
        - $ref: '#/components/parameters/StatusParam'
        - $ref: '#/components/parameters/IncentiveSourceParam'
        - $ref: '#/components/parameters/IncentiveTypeParam'
      responses:
        '200':
          description: Successfully retrieved incentives
          headers:
            X-Cache:
              description: Indicates if response was served from cache
              schema:
                type: string
                enum: [HIT, MISS]
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetIncentivesResponse'
        '400':
          $ref: '#/components/responses/ValidationErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundErrorResponse'
        '500':
          $ref: '#/components/responses/InternalErrorResponse'

  /api/incentives/health:
    get:
      tags:
        - Health
      summary: Get API health status
      description: Returns health status of all data providers
      operationId: getHealthStatus
      responses:
        '200':
          description: Health status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      providers:
                        type: object
                        additionalProperties:
                          type: boolean
                        example:
                          ACI: true
                          Merkl: true
                          ExternalPoints: true
                          Onchain: true

components:
  parameters:
    ChainIdParam:
      name: chainId
      in: query
      description: Filter by chain ID(s). Supports single value or comma-separated list.
      schema:
        oneOf:
          - type: integer
          - type: string
            pattern: '^\d+(,\d+)*$'
      examples:
        single:
          value: 1
          summary: Single chain (Ethereum)
        multiple:
          value: '1,137,42161'
          summary: Multiple chains (Ethereum, Polygon, Arbitrum)

    StatusParam:
      name: status
      in: query
      description: Filter by campaign status. Supports single value or comma-separated list.
      schema:
        oneOf:
          - $ref: '#/components/schemas/Status'
          - type: string
            pattern: '^(LIVE|PAST|UPCOMING)(,(LIVE|PAST|UPCOMING))*$'
      examples:
        single:
          value: LIVE
          summary: Only live campaigns
        multiple:
          value: 'LIVE,UPCOMING'
          summary: Live and upcoming campaigns

    IncentiveSourceParam:
      name: source
      in: query
      description: Filter by incentive source
      schema:
        $ref: '#/components/schemas/IncentiveSource'

    IncentiveTypeParam:
      name: type
      in: query
      description: Filter by incentive type
      schema:
        $ref: '#/components/schemas/IncentiveType'

  schemas:
    ApiResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true

    GetIncentivesResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          required:
            - data
          properties:
            data:
              type: object
              required:
                - incentives
                - totalCount
                - lastUpdated
              properties:
                incentives:
                  type: array
                  items:
                    $ref: '#/components/schemas/Incentive'
                totalCount:
                  type: integer
                  description: Total number of incentives (before filtering)
                  example: 150
                lastUpdated:
                  type: string
                  format: date-time
                  description: Timestamp of when data was last fetched
                  example: '2025-01-15T10:30:00Z'

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          required:
            - error
          properties:
            success:
              type: boolean
              example: false
            error:
              type: object
              required:
                - message
                - code
              properties:
                message:
                  type: string
                  example: 'Failed to fetch incentives'
                code:
                  type: string
                  example: 'INTERNAL_ERROR'
                details:
                  type: array
                  items:
                    type: object
                    properties:
                      field:
                        type: string
                        example: 'source'
                      message:
                        type: string
                        example: 'Invalid option: expected one of \"ACI_MASIV_API\"|\"MERKL_API\"|\"ONCHAIN_RPC\"|\"LOCAL_CONFIG\"'

    BaseIncentive:
      type: object
      required:
        - name
        - chainId
        - rewardedTokens
        - type
        - source
        - status
        - description
        - claimLink
      properties:
        name:
          type: string
          example: 'Etherfi Points - Supply weETH on Ethereum'
        chainId:
          type: integer
          example: 1
        rewardedTokens:
          type: array
          items:
            $ref: '#/components/schemas/Token'
        type:
          $ref: '#/components/schemas/IncentiveType'
        source:
          $ref: '#/components/schemas/IncentiveSource'
        status:
          $ref: '#/components/schemas/Status'
        description:
          type: string
        claimLink:
          type: string
          format: uri
          example: 'https://app.merkl.xyz/'
        currentCampaignConfig:
          $ref: '#/components/schemas/CampaignConfig'
        nextCampaignConfig:
          $ref: '#/components/schemas/CampaignConfig'
        allCampaignsConfigs:
          type: array
          items:
            $ref: '#/components/schemas/CampaignConfig'
        infosLink:
          type: string
          format: uri
          example: 'https://governance.aave.com/t/arfc-sts-loop-incentive-program/22368'
        additionalData:
          type: object
          additionalProperties: true

    TokenIncentive:
      allOf:
        - $ref: '#/components/schemas/BaseIncentive'
        - type: object
          required:
            - type
            - rewardToken
          properties:
            type:
              type: string
              enum: [TOKEN]
            rewardToken:
              $ref: '#/components/schemas/Token'
            currentApr:
              type: number
              format: float
              example: 5.6
              description: Annual Percentage Rate

    PointIncentive:
      allOf:
        - $ref: '#/components/schemas/BaseIncentive'
        - type: object
          required:
            - type
            - point
            - pointValue
          properties:
            type:
              type: string
              enum: [POINT]
            point:
              $ref: '#/components/schemas/Point'
            pointValue:
              type: number
              format: float
              example: 1.2
            pointValueUnit:
              type: string
              example: 'per_token'

    PointWithoutValueIncentive:
      allOf:
        - $ref: '#/components/schemas/BaseIncentive'
        - type: object
          required:
            - type
            - point
          properties:
            type:
              type: string
              enum: [POINT_WITHOUT_VALUE]
            point:
              $ref: '#/components/schemas/Point'

    Incentive:
      oneOf:
        - $ref: '#/components/schemas/TokenIncentive'
        - $ref: '#/components/schemas/PointIncentive'
        - $ref: '#/components/schemas/PointWithoutValueIncentive'
      discriminator:
        propertyName: type
        mapping:
          TOKEN: '#/components/schemas/TokenIncentive'
          POINT: '#/components/schemas/PointIncentive'
          POINT_WITHOUT_VALUE: '#/components/schemas/PointWithoutValueIncentive'
      description: |
        Represents any type of incentive (token, point with value, or point without value).

    Token:
      type: object
      required:
        - name
        - symbol
        - address
        - chainId
        - decimals
      properties:
        name:
          type: string
          example: 'Wrapped Ether'
        symbol:
          type: string
          example: 'WETH'
        address:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'
        chainId:
          type: integer
          example: 1
        decimals:
          type: integer
          example: 18
        price:
          type: number
          format: float
          example: 4250.75
        priceFeed:
          type: string
          example: '0x5424384B256154046E9667dDFaaa5e550145215e'

    Point:
      type: object
      required:
        - name
        - protocol
      properties:
        name:
          type: string
          example: 'Etherfi Loyalty Points'
        protocol:
          type: string
          example: 'Etherfi'
        tgePrice:
          type: number
          format: float
          example: 0.5

    CampaignConfig:
      type: object
      required:
        - startTimestamp
        - endTimestamp
      properties:
        startTimestamp:
          type: integer
          format: int64
          example: 1735700400
          description: Unix timestamp
        endTimestamp:
          type: integer
          format: int64
          example: 1767236400
          description: Unix timestamp
        budget:
          type: number
          format: float
          example: 200000
        apr:
          type: number
          format: float
          example: 8.5
        pointValue:
          type: number
          format: float
          example: 3

    IncentiveSource:
      type: string
      enum: ['ACI_MASIV_API', 'MERKL_API', 'ONCHAIN_RPC', 'LOCAL_CONFIG']
      description: |
        - ACI_MASIV_API: Incentives from ACI Masiv infrastructure
        - MERKL_API: Incentives from Merkl infrastructure
        - ONCHAIN_RPC: Incentives fetched directly from onchain data
        - LOCAL_CONFIG: Incentives from local configuration (external points, etc...)

    IncentiveType:
      type: string
      enum: [TOKEN, POINT, POINT_WITHOUT_VALUE]
      description: |
        - TOKEN: Token incentives (with APR)
        - POINT: Points incentive (with value)
        - POINT_WITHOUT_VALUE: Points incentive (without value)

    Status:
      type: string
      enum: [LIVE, PAST, SOON]
      description: |
        - LIVE: Campaign is currently active
        - PAST: Campaign has ended
        - SOON: Campaign will start in the future

  responses:
    ValidationErrorResponse:
      description: Validation error - Invalid query parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundErrorResponse:
      description: Not found error - Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalErrorResponse:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
